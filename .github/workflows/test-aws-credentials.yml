name: Test AWS Credentials

on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  test-dev-account:
    name: Test Dev Account
    runs-on: ubuntu-latest
    environment: dev-aws-account
    
    steps:
    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v4
      with:
        role-to-assume: ${{ secrets.AWS_ROLE_ARN_DEV }}
        aws-region: ${{ vars.DOMAIN_REGION }}
        role-session-name: test-dev-credentials
    
    - name: Verify credentials
      run: |
        echo "=== AWS Caller Identity ==="
        aws sts get-caller-identity
        echo ""
        echo "=== Environment Variables ==="
        echo "DOMAIN_REGION: ${{ vars.DOMAIN_REGION }}"
        echo "AWS_REGION: $AWS_REGION"
        echo "AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION"

  test-test-account:
    name: Test Test Account
    runs-on: ubuntu-latest
    environment: test-aws-account
    
    steps:
    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v4
      with:
        role-to-assume: ${{ secrets.AWS_ROLE_ARN_TEST }}
        aws-region: ${{ vars.DOMAIN_REGION }}
        role-session-name: test-test-credentials
    
    - name: Verify credentials
      run: |
        echo "=== AWS Caller Identity ==="
        aws sts get-caller-identity
        echo ""
        echo "=== Environment Variables ==="
        echo "DOMAIN_REGION: ${{ vars.DOMAIN_REGION }}"
        echo "AWS_REGION: $AWS_REGION"
        echo "AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION"

  test-prod-account:
    name: Test Prod Account
    runs-on: ubuntu-latest
    environment: prod-aws-account
    
    steps:
    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v4
      with:
        role-to-assume: ${{ secrets.AWS_ROLE_ARN_PROD }}
        aws-region: ${{ vars.DOMAIN_REGION }}
        role-session-name: test-prod-credentials
    
    - name: Verify credentials
      run: |
        echo "=== AWS Caller Identity ==="
        aws sts get-caller-identity
        echo ""
        echo "=== Environment Variables ==="
        echo "DOMAIN_REGION: ${{ vars.DOMAIN_REGION }}"
        echo "AWS_REGION: $AWS_REGION"
        echo "AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION"
