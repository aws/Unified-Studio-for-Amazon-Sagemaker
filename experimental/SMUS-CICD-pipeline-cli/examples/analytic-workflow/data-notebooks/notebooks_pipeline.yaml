pipelineName: IntegrationTestNotebooks

bundle:
  bundlesDirectory: /tmp/bundles
  storage:
    - name: notebooks
      connectionName: default.s3_shared
      include: ['notebooks/', 'workflows/']
      exclude: ['.ipynb_checkpoints/', '__pycache__/']

targets:
  dev:
    stage: DEV
    domain:
      tags:
        purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-2}
    project:
      name: dev-marketing
    environment_variables:
      S3_PREFIX: dev

  test:
    stage: TEST
    domain:
      tags:
        purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-1}
    project:
      name: test-notebooks
    tests:
      folder: examples/analytic-workflow/data-notebooks/pipeline_tests/
    initialization:
      project:
        create: true
        owners: [Eng1, arn:aws:iam::*:role/GitHubActionsRole-SMUS-CLI-Tests]
        contributors: []
        role:
          arn: arn:aws:iam::*:role/SMUSCICDTestRole
      connections:
        - name: mlflow-server
          type: MLFLOW
          properties:
            trackingServerArn: "arn:aws:sagemaker:${STS_REGION}:${STS_ACCOUNT_ID}:mlflow-tracking-server/smus-integration-mlflow-use2"
            trackingServerName: "smus-integration-mlflow-use2"
      connections:
        - name: mlflow-server
          type: MLFLOW
          properties:
            trackingServerArn: "arn:aws:sagemaker:${STS_REGION}:${STS_ACCOUNT_ID}:mlflow-tracking-server/smus-integration-mlflow-use2"
            trackingServerName: "smus-integration-mlflow-use2"
    bundle_target_configuration:
      storage:
        - name: notebooks
          connectionName: default.s3_shared
          targetDirectory: 'notebooks/bundle'
    environment_variables:
      S3_PREFIX: test

workflows:
  - workflowName: parallel_notebooks_workflow
    engine: airflow-serverless
