pipelineName: IntegrationTestMLWorkflow

bundle:
  bundlesDirectory: /tmp/bundles
  storage:
    - name: training-code
      connectionName: default.s3_shared
      include: ['ml/training-workflow']
    - name: ml-workflows
      connectionName: default.s3_shared
      include: ['ml/workflows']

targets:
  dev: 
    stage: DEV
    domain:
      name: BETA_10282025_Domain
      region: us-east-1
    project: 
      name: dev-marketing
    environment_variables:
      S3_PREFIX: dev

  test: 
    stage: TEST
    domain:
      name: BETA_10282025_Domain
      region: us-east-1
    project: 
      name: test-marketing
    tests:
      folder: examples/analytic-workflow/ml/pipeline_tests/
    initialization:
      project: 
        create: true
        owners: [Eng1, arn:aws:iam::*:role/GitHubActionsRole-SMUS-CLI-Tests]
        contributors: []
        role:
          arn: arn:aws:iam::*:role/SMUSCICDTestRole
        userParameters: 
          - EnvironmentConfigurationName: 'Lakehouse Database'
            parameters:
              - name: glueDbName
                value: analytic_workflow_test_db
      connections:
        - name: mlflow-server
          type: MLFLOW
          properties:
            # trackingServerName: "smus-integration-mlflow"
            trackingServerArn: "arn:aws:sagemaker:us-east-1:*:mlflow-tracking-server/smus-integration-mlflow"
    bundle_target_configuration:
      storage:
        - name: training-code
          connectionName: default.s3_shared
          targetDirectory: 'ml/bundle/training-code'
          compression: 'gz'
        - name: ml-workflows
          connectionName: default.s3_shared
          targetDirectory: 'ml/bundle/workflows'
    environment_variables:
      S3_PREFIX: test

workflows:
  - workflowName: ml_dev_workflow_v3
    engine: airflow-serverless
