applicationName: IntegrationTestETLWorkflow
content:
  storage:
  - name: dashboard-glue-quick
    connectionName: default.s3_shared
    include:
    - dashboard-glue-quick
    exclude:
    - .ipynb_checkpoints/
    - __pycache__/
    - '*.pyc'
    - test_*.sh
  git:
  - repository: covid-19-dataset
    url: https://github.com/datasets/covid-19.git
  quicksight:
  - dashboardId: sample-dashboard
    source: quicksight/sample-dashboard.qs
    overrideParameters:
      ResourceIdOverrideConfiguration:
        PrefixForAllResources: deployed-{proj.name}-covid-
      Dashboards:
      - DashboardId: e0772d4e-bd69-444e-a421-cb3f165dbad8
        Name: TotalDeathByCountry-{proj.name}
    permissions:
    - principal: arn:aws:quicksight:${DEV_DOMAIN_REGION:us-east-2}:*:user/default/amirbo
      actions:
      - quicksight:DescribeDashboard
      - quicksight:QueryDashboard
  workflows:
  - workflowName: covid_dashboard_glue_quick_pipeline
    connectionName: default.workflow_serverless
stages:
  dev:
    stage: DEV
    domain:
      tags:
        purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-2}
    project:
      name: dev-marketing
    environment_variables:
      S3_PREFIX: dev
  test:
    stage: TEST
    domain:
      tags:
        purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-2}
    project:
      name: test-marketing
      create: true
      owners:
      - Eng1
      - arn:aws:iam::*:role/GitHubActionsRole-SMUS-CLI-Tests
      contributors: []
      role:
        arn: arn:aws:iam::*:role/SMUSCICDTestRole
    environment_variables:
      S3_PREFIX: test
      AWS_REGION: ${DEV_DOMAIN_REGION:us-east-1}
    deployment_configuration:
      storage:
      - name: dashboard-glue-quick
        connectionName: default.s3_shared
        targetDirectory: dashboard-glue-quick/bundle
      git:
      - name: covid-19-dataset
        connectionName: default.s3_shared
        targetDirectory: repos
    quicksight:
    - dashboardId: deployed-test-monitoring-dashboard
      source: export
      permissions:
      - principal: arn:aws:quicksight:us-east-1:198737698272:user/default/amirbo
        actions:
        - quicksight:DescribeDashboard
        - quicksight:QueryDashboard
tests:
  folder: examples/analytic-workflow/dashboard-glue-quick/app_tests/
