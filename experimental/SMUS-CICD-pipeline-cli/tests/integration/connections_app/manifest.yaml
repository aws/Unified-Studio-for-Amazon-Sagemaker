applicationName: ConnectionsTestBundle
content:
  storage:
  - name: src
    connectionName: default.s3_shared
    include:
    - src
    exclude:
    - .ipynb_checkpoints/
    - __pycache__/
    - '*.pyc'
    - .libs.json
stages:
  test:
    stage: TEST
    domain:
      tags:
        purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-1}
    project:
      name: connections-test-project
      create: true
      profile_name: All capabilities
      owners:
      - Eng1
      - arn:aws:iam::${AWS_ACCOUNT_ID}:role/Admin
      contributors: []
    deployment_configuration:
      storage:
      - name: src
        connectionName: default.s3_shared
        targetDirectory: connections-test/src
    bootstrap:
      actions:
      - type: datazone.create_environment
        environment_configuration_name: OnDemand Workflows
      - type: datazone.create_connection
        name: s3-data-lake
        connection_type: S3
        properties:
          s3Uri: s3://test-connections-bucket/data/
      - type: datazone.create_connection
        name: iam-lineage
        connection_type: IAM
        properties:
          glueLineageSyncEnabled: true
      - type: datazone.create_connection
        name: spark-glue-proc
        connection_type: SPARK_GLUE
        properties:
          glueVersion: '4.0'
          workerType: G.1X
          numberOfWorkers: 5
      - type: datazone.create_connection
        name: workflows-serverless
        connection_type: WORKFLOWS_SERVERLESS
        properties: {}
      - type: datazone.create_connection
        name: mlflow-experiments
        connection_type: MLFLOW
        properties:
          trackingServerArn: arn:aws:sagemaker:${DEV_DOMAIN_REGION:us-east-2}:${AWS_ACCOUNT_ID}:mlflow-tracking-server/${MLFLOW_TRACKING_SERVER_NAME:smus-integration-mlflow-use2}
      - type: datazone.create_connection
        name: athena-query-engine
        connection_type: ATHENA
        properties:
          workgroupName: primary
      - type: datazone.create_connection
        name: glue-catalog
        connection_type: GLUE
        properties:
          glueConnectionName: test-glue-connection
      - type: datazone.create_connection
        name: redshift-warehouse
        connection_type: REDSHIFT
        properties:
          clusterName: test-cluster
          databaseName: dev
          host: test-cluster.abc123.${DEV_DOMAIN_REGION:us-east-1}.redshift.amazonaws.com
          port: 5439
      - type: datazone.create_connection
        name: spark-emr-processing
        connection_type: SPARK_EMR
        properties:
          computeArn: arn:aws:emr-serverless:${DEV_DOMAIN_REGION:us-east-1}:${AWS_ACCOUNT_ID}:/applications/test-app
          runtimeRole: arn:aws:iam::${AWS_ACCOUNT_ID}:role/EMRServerlessExecutionRole
      - type: datazone.create_connection
        name: hyperpod-cluster
        connection_type: HYPERPOD
        properties:
          clusterArn: arn:aws:sagemaker:${DEV_DOMAIN_REGION:us-east-1}:${AWS_ACCOUNT_ID}:cluster/test-hyperpod-cluster
