pipelineName: IntegrationTestMultiTarget
bundle:
  bundlesDirectory: /tmp/bundles
  storage:
  - connectionName: default.s3_shared
    append: false
    include:
    - src
    exclude:
    - .ipynb_checkpoints/
    - __pycache__/
    - '*.pyc'
    name: code
  - connectionName: default.s3_shared
    append: true
    include:
    - workflows
    exclude:
    - .ipynb_checkpoints/
    - __pycache__/
    - '*.pyc'
    name: workflows
  catalog:
    assets:
    - selector:
        search:
          assetType: GlueTable
          identifier: covid19_db.countries_aggregated
      permission: READ
      requestReason: Required access for pipeline IntegrationTestMultiTarget
    - selector:
        search:
          assetType: GlueTable
          identifier: covid19_db.worldwide_aggregate
      permission: READ
      requestReason: Second table access for multi-asset testing
targets:
  dev:
    stage: DEV
    domain:
      tags:
        purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-2}
    project:
      name: dev-marketing
    bundle_target_configuration:
      storage:
      - connectionName: default.s3_shared
        name: code
        targetDirectory: src
      - connectionName: default.s3_shared
        name: workflows
        targetDirectory: workflows
  test:
    stage: TEST
    domain:
      tags:
        purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-2}
    project:
      name: integration-test-test
    tests:
      folder: tests/integration/multi_target_pipeline/pipeline_tests/
    initialization:
      project:
        create: true
        profileName: All capabilities
        owners:
        - Eng1
        - arn:aws:iam::058264284947:role/GitHubActionsRole-SMUS-CLI-Tests
        - Admin
        contributors: []
        userParameters:
        - EnvironmentConfigurationName: Lakehouse Database
          parameters:
          - name: glueDbName
            value: multi_target_test_db
      environments:
      - EnvironmentConfigurationName: OnDemand Workflows
    bundle_target_configuration:
      storage:
      - connectionName: default.s3_shared
        name: code
        targetDirectory: src
      - connectionName: default.s3_shared
        name: workflows
        targetDirectory: workflows
  prod:
    stage: PROD
    domain:
      tags:
        purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-2}
    project:
      name: integration-test-prod
    initialization:
      project:
        create: true
        profileName: All capabilities
        owners:
        - Eng1
        - arn:aws:iam::058264284947:role/GitHubActionsRole-SMUS-CLI-Tests
        contributors: []
        userParameters:
        - EnvironmentConfigurationName: Lakehouse Database
          parameters:
          - name: glueDbName
            value: multi_target_prod_db
      environments:
      - EnvironmentConfigurationName: OnDemand Workflows
    bundle_target_configuration:
      storage:
      - connectionName: default.s3_shared
        name: code
        targetDirectory: src
      - connectionName: default.s3_shared
        name: workflows
        targetDirectory: workflows
workflows:
- workflowName: test_dag
  connectionName: project.workflow_mwaa
  engine: MWAA
- workflowName: test_dag_not_mentioned
  connectionName: project.workflow_mwaa
  engine: MWAA
- workflowName: runGettingStartedNotebook
  connectionName: project.workflow_mwaa
  engine: MWAA
