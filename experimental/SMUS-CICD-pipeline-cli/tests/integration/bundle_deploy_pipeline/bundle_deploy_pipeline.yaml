pipelineName: IntegrationTestMultiTarget

# What to include in deployment bundles
bundle:
  bundlesDirectory: /tmp/bundles
  workflow:
    - connectionName: default.s3_shared
      append: true
      include: ['workflows']
      exclude: ['.ipynb_checkpoints/', '__pycache__/', '*.pyc']
  storage:
    - connectionName: default.s3_shared
      append: false
      include: ['src']
      exclude: ['.ipynb_checkpoints/', '__pycache__/', '*.pyc']

# Target environments (test only, no dev or prod)
targets:
  test: 
    stage: TEST
    domain:
      name: cicd-test-domain
      region: ${DEV_DOMAIN_REGION:us-east-2}
    project: 
      name: integration-test-test
    tests:
      folder: tests/integration/bundle_deploy_pipeline/pipeline_tests/
    initialization:
      project: 
        create: true  # Enable auto-create for integration tests
        profileName: 'All capabilities'
        owners: [Eng1, arn:aws:iam::058264284947:role/GitHubActionsRole-SMUS-CLI-Tests, Admin]
        contributors: []                     
      environments: 
        - EnvironmentConfigurationName: 'OnDemand Workflows' 
    bundle_target_configuration:
      storage:
        connectionName: default.s3_shared
        directory: 'src'
      workflows:
        connectionName: default.s3_shared
        directory: 'workflows'   

# Workflows to trigger after deployment
workflows:
  - workflowName: execute_notebooks_dag
    connectionName: project.workflow_mwaa
    logging: console
    engine: MWAA
