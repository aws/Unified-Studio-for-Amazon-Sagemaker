pipelineName: IntegrationTestAnalyticWorkflowBundle

# What to include in deployment bundles
bundle:
  bundlesDirectory: /tmp/bundles
  storage:
    - name: ml
      connectionName: default.s3_shared
      append: false
      include: ['code/ml']
      exclude: ['.ipynb_checkpoints/', '__pycache__/', '*.pyc', '*.tar.gz', 'test_*.py']

# Target environments (dev, test)
targets:
  dev: 
    stage: DEV
    domain:
      tags:
          purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-1}
    project: 
      name: dev-marketing
    environment_variables:
      S3_PREFIX: dev

  test: 
    stage: TEST
    domain:
      tags:
          purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-1}
    project: 
      name: analytic-workflow-test
    tests:
      folder: tests/integration/analytic_workflow_bundle/pipeline_tests/
    initialization:
      project: 
        create: true  # Enable auto-create for integration tests
        profileName: 'All capabilities'
        owners: [Eng1, arn:aws:iam::058264284947:role/GitHubActionsRole-SMUS-CLI-Tests, Admin]
        contributors: []
        userParameters: 
          - EnvironmentConfigurationName: 'Lakehouse Database'
            parameters:
              - name: glueDbName
                value: analytic_workflow_test_db                     
    bundle_target_configuration:
      storage:
        - name: ml
          connectionName: default.s3_shared
          targetDirectory: 'ml'
    environment_variables:
      S3_PREFIX: test

# Workflows to trigger after deployment
workflows:
  - workflowName: ml_dev_workflow_v3
    engine: airflow-serverless
