applicationName: GlueMwaaCatalogApp
content:
  storage:
  - connectionName: default.s3_shared
    append: false
    include:
    - src
    exclude:
    - .ipynb_checkpoints/
    - __pycache__/
    - '*.pyc'
    name: code
  - connectionName: default.s3_shared
    append: true
    include:
    - workflows
    exclude:
    - .ipynb_checkpoints/
    - __pycache__/
    - '*.pyc'
    name: workflows
  catalog:
    assets:
    - selector:
        search:
          assetType: GlueTable
          identifier: covid19_db.countries_aggregated
      permission: READ
      requestReason: Required access for pipeline GlueMwaaCatalogApp
    - selector:
        search:
          assetType: GlueTable
          identifier: covid19_db.worldwide_aggregate
      permission: READ
      requestReason: Second table access for multi-asset testing
stages:
  dev:
    stage: DEV
    domain:
      tags:
        purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-2}
    project:
      name: dev-marketing
    deployment_configuration:
      storage:
      - connectionName: default.s3_shared
        name: code
        targetDirectory: src
      - connectionName: default.s3_shared
        name: workflows
        targetDirectory: workflows
  test:
    stage: TEST
    domain:
      tags:
        purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-2}
    project:
      name: test-glue-mwaa-catalog-app
      create: true
      profileName: All capabilities
      owners:
      - Eng1
      - arn:aws:iam::${AWS_ACCOUNT_ID}:role/GitHubActionsRole-SMUS-CLI-Tests
      - Admin
      contributors: []
      user_parameters:
      - environment_configuration_name: Lakehouse Database
        parameters:
        - name: glueDbName
          value: glue_mwaa_catalog_app_test_db
    deployment_configuration:
      storage:
      - connectionName: default.s3_shared
        name: code
        targetDirectory: src
      - connectionName: default.s3_shared
        name: workflows
        targetDirectory: workflows
    bootstrap:
      actions:
      - type: datazone.create_environment
        environment_configuration_name: OnDemand Workflows
  prod:
    stage: PROD
    domain:
      tags:
        purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-2}
    project:
      name: prod-glue-mwaa-catalog-app
      create: true
      profileName: All capabilities
      owners:
      - Eng1
      - arn:aws:iam::${AWS_ACCOUNT_ID}:role/GitHubActionsRole-SMUS-CLI-Tests
      - arn:aws:iam::${AWS_ACCOUNT_ID}:role/Admin
      contributors: []
      user_parameters:
      - environment_configuration_name: Lakehouse Database
        parameters:
        - name: glueDbName
          value: glue_mwaa_catalog_app_prod_db
    deployment_configuration:
      storage:
      - connectionName: default.s3_shared
        name: code
        targetDirectory: src
      - connectionName: default.s3_shared
        name: workflows
        targetDirectory: workflows
    bootstrap:
      actions:
      - type: datazone.create_environment
        environment_configuration_name: OnDemand Workflows
tests:
  folder: tests/integration/glue-mwaa-catalog-app/pipeline_tests/
