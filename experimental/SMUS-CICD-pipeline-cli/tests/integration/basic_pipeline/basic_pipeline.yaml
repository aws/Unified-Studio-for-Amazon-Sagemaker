pipelineName: BasicTestPipeline

workflows:
- workflowName: test_dag
  connectionName: project.workflow_mwaa
  engine: MWAA 
  parameters: 
    default-sql-connection: project.athena 
  logging: console 

bundle:
  bundlesDirectory: /tmp/bundles
  workflow:
    - connectionName: default.s3_shared
      include: 
        - 'workflows'
      exclude: 
        - '.ipynb_checkpoints/'
        - '__pycache__/'
        - '*.pyc'
        - '.libs.json'    
  storage:
    - connectionName: default.s3_shared
      include: 
        - 'src'
      exclude: 
        - '.ipynb_checkpoints/'
        - '__pycache__/'
        - '*.pyc'
        - '.libs.json'  
  git:
    repository: covid-19-dateset
    url: https://github.com/datasets/covid-19.git
    targetDir: ./src

targets:
    dev: 
       stage: DEV
       default: true
       domain:
         name: cicd-test-domain
         region: ${DEV_DOMAIN_REGION:us-east-2}
       initialization:
          environments: 
            - EnvironmentConfigurationName: 'OnDemand Workflows'       
       project: 
         name: dev-marketing
       workflows:
        - workflowName: prepareData        
    test:
       stage: TEST 
       domain:
         name: cicd-test-domain
         region: ${DEV_DOMAIN_REGION:us-east-2}
       project: 
         name: test-marketing-8
       initialization:
          project: 
            create: True
            profileName: 'All capabilities'
            owners: 
            - Eng1
            - arn:aws:iam::058264284947:role/GitHubActionsRole-SMUS-CLI-Tests
            contributors: []                     
          # environments: 
          #   - EnvironmentConfigurationName: 'OnDemand Workflows'
       bundle_target_configuration:
          storage:
            connectionName: default.s3_shared
            directory: 'src'        
          workflows:
            connectionName: default.s3_shared
            directory: 'workflows'   
          git: 
            connectionName: default.s3_shared
            directory: 'src/git'                          
         
       workflows:
        - workflowName: prepareData        
          parameters: 
              stage_database: TestDB
              sampleSize: 5000     
    prod: 
       stage: PROD
       domain:
         name: cicd-test-domain
         region: ${DEV_DOMAIN_REGION:us-east-2}
       project: 
         name: prod-marketing
       initialization:
          project: 
            create: True
            profileName: 'All capabilities'
            owners: 
            - Eng1
            - arn:aws:iam::058264284947:role/GitHubActionsRole-SMUS-CLI-Tests
            contributors: []             
          environments: 
            - EnvironmentConfigurationName: 'OnDemand Workflows'       
       bundle_target_configuration:
          storage:
            connectionName: default.s3_shared
            directory: 'src'
          workflows:
            connectionName: default.s3_shared
            directory: 'workflows'
          git: 
            connectionName: default.s3_shared
            directory: 'src/git'              

       workflows:
       - workflowName: prepareData        
         parameters: 
            stage_database: ProdDB
