pipelineName: BasicTestPipeline

# Enable monitoring for integration tests
monitoring:
  eventbridge:
    enabled: true
    eventBusName: default
    includeMetadata: true

workflows:
- workflowName: basic_test_workflow
  connectionName: project.workflow_serverless
  engine: airflow-serverless
- workflowName: expected_failure_workflow
  connectionName: project.workflow_serverless
  engine: airflow-serverless

bundle:
  bundlesDirectory: /tmp/bundles
  storage:
    - name: code 
      connectionName: default.s3_shared  
      include: 
        - 'code/src/'
      exclude: 
        - '.ipynb_checkpoints/'
        - '__pycache__/'
        - '*.pyc'
        - '.libs.json'
  git:
    - repository: covid-19-dateset
      url: https://github.com/datasets/covid-19.git

targets:
    dev: 
       stage: DEV
       domain:
         tags:
          purpose: smus-cicd-testing
         region: ${DEV_DOMAIN_REGION:us-east-2}   
       project: 
         name: dev-marketing
       initialization:
          project: 
            create: True
            owners: 
            - Eng1
            - arn:aws:iam::*:role/GitHubActionsRole-SMUS-CLI-Tests
            contributors: []
            role:
              arn: arn:aws:iam::*:role/SMUSCICDTestRole

    test:
       stage: TEST 
       domain:
         tags:
          purpose: smus-cicd-testing
         region: ${DEV_DOMAIN_REGION:us-east-2}
       project: 
         name: test-marketing
       initialization:
          project: 
            create: True
            owners: 
            - Eng1
            - arn:aws:iam::*:role/GitHubActionsRole-SMUS-CLI-Tests
            contributors: []
            role:
              arn: arn:aws:iam::*:role/SMUSCICDTestRole
          connections:
            - name: mlflow-server
              type: MLFLOW
              properties:
                trackingServerName: "smus-integration-mlflow-use2"
                trackingServerArn: "arn:aws:sagemaker:us-east-2:058264284947:mlflow-tracking-server/smus-integration-mlflow-use2"                     
       bundle_target_configuration:
          storage:
            - name: code
              connectionName: default.s3_shared
              targetDirectory: '.'   
          git:
            - name: covid-19-dateset
              connectionName: default.s3_shared
              targetDirectory: 'repos'                          