monitoring:
  eventbridge:
    enabled: true
    eventBusName: default
    includeMetadata: true
applicationName: BasicTestBundle
content:
  storage:
  - name: code
    connectionName: default.s3_shared
    include:
    - code/src/
    exclude:
    - .ipynb_checkpoints/
    - __pycache__/
    - '*.pyc'
    - .libs.json
  git:
  - repository: covid-19-dateset
    url: https://github.com/datasets/covid-19.git
  workflows:
  - workflowName: basic_test_workflow
    connectionName: default.workflow_serverless
  - workflowName: expected_failure_workflow
    connectionName: default.workflow_serverless
stages:
  dev:
    stage: DEV
    domain:
      tags:
        purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-2}
    project:
      name: dev-marketing
      create: true
      owners:
      - Eng1
      - arn:aws:iam::${AWS_ACCOUNT_ID}:role/GitHubActionsRole-SMUS-CLI-Tests
      - arn:aws:iam::${AWS_ACCOUNT_ID}:role/Admin
      contributors: []
      role:
        arn: arn:aws:iam::${AWS_ACCOUNT_ID}:role/GitHubActionsRole-SMUS-CLI-Tests
  test:
    stage: TEST
    domain:
      tags:
        purpose: smus-cicd-testing
      region: ${DEV_DOMAIN_REGION:us-east-2}
    project:
      name: test-project-basic
      create: true
      owners:
      - Eng1
      - arn:aws:iam::${AWS_ACCOUNT_ID}:role/GitHubActionsRole-SMUS-CLI-Tests
      - arn:aws:iam::${AWS_ACCOUNT_ID}:role/Admin
      contributors: []
      role:
        policies:
        - arn:aws:iam::aws:policy/SageMakerStudioUserIAMPermissiveExecutionPolicy
    bootstrap:
      actions:
      - type: datazone.create_connection
        name: mlflow-server
        connection_type: MLFLOW
        properties:
          trackingServerName: ${MLFLOW_TRACKING_SERVER_NAME:smus-integration-mlflow-use2}
          trackingServerArn: arn:aws:sagemaker:${DEV_DOMAIN_REGION:us-east-2}:${AWS_ACCOUNT_ID}:mlflow-tracking-server/${MLFLOW_TRACKING_SERVER_NAME:smus-integration-mlflow-use2}
      - type: workflow.create
        workflowName: basic_test_workflow
      - type: workflow.run
        workflowName: basic_test_workflow
        trailLogs: false
      - type: workflow.create
        workflowName: expected_failure_workflow
      - type: workflow.run
        workflowName: expected_failure_workflow
        trailLogs: false
      - type: workflow.log
        workflowName: expected_failure_workflow
    deployment_configuration:
      storage:
      - name: code
        connectionName: default.s3_shared
        targetDirectory: .
      git:
      - name: covid-19-dateset
        connectionName: default.s3_shared
        targetDirectory: repos
